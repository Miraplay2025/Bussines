<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp WPPConnect</title>
<style>
body { font-family: Arial; text-align: center; margin: 20px; }
img { width: 250px; height: 250px; }
#message-form { display: none; margin-top: 20px; }
input, textarea { padding: 10px; margin: 5px; width: 80%; max-width: 400px; }
button { padding: 10px 20px; margin-top: 10px; }
</style>
</head>
<body>
<h1>WhatsApp WPPConnect</h1>
<div id="qr-container">
    <p>Aguardando QR Code...</p>
    <img id="qr-img" src="" alt="QR Code" style="display:none;">
</div>

<div id="message-form">
    <h2>Enviar Mensagem</h2>
    <form id="sendForm">
        <input type="text" id="phone" placeholder="NÃºmero com DDI e DDD" required><br>
        <textarea id="message" placeholder="Mensagem" required></textarea><br>
        <button type="submit">Enviar</button>
    </form>
    <p id="status"></p>
</div>

<script>
async function fetchQR() {
    try {
        const res = await fetch("/qr");
        const data = await res.json();
        if (data.qr) {
            document.getElementById("qr-img").src = "data:image/png;base64," + data.qr;
            document.getElementById("qr-img").style.display = "block";
        } else {
            setTimeout(fetchQR, 2000);
        }
    } catch (e) {
        setTimeout(fetchQR, 2000);
    }
}

fetchQR();

const qrInterval = setInterval(async () => {
    const res = await fetch("/qr");
    const data = await res.json();
    if (!data.qr) {
        clearInterval(qrInterval);
        document.getElementById("qr-container").style.display = "none";
        document.getElementById("message-form").style.display = "block";
    }
}, 3000);

document.getElementById("sendForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const phone = document.getElementById("phone").value;
    const message = document.getElementById("message").value;
    const res = await fetch("/send_message", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `phone=${phone}&message=${encodeURIComponent(message)}`
    });
    const data = await res.json();
    document.getElementById("status").innerText = JSON.stringify(data);
});
</script>
</body>
</html>
