<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WhatsApp QR Code</title>
<style>
body { font-family: Arial; text-align:center; margin: 20px; }
img { max-width: 300px; height: auto; margin: 20px auto; display:block; }
.form-box { max-width: 400px; margin:auto; padding:20px; border:1px solid #ccc; border-radius:8px; }
input, textarea, button { width:100%; padding:10px; margin:8px 0; border-radius:5px; border:1px solid #ccc; }
button { background:green; color:white; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>
<h2>Conectar ao WhatsApp</h2>

<div id="qr-container">
<p>Aguardando QR Code...</p>
<button onclick="getQR()">Obter QR Code</button>
<div id="qr"></div>
</div>

<div id="form-container" style="display:none;">
<h3>Enviar Mensagem</h3>
<div class="form-box">
<form id="msgForm">
<input type="text" name="phone" placeholder="Número (ex: 258840000000)" required>
<textarea name="message" placeholder="Digite sua mensagem" required></textarea>
<button type="submit">Enviar</button>
</form>
</div>
</div>

<script>
function getQR() {
    fetch('/get_qr')
    .then(res => res.json())
    .then(data => {
        if(data.qrcode){
            document.getElementById('qr').innerHTML = `<img src="data:image/png;base64,${data.qrcode}" alt="QR Code">`;
        }
        if(data.status === "CONNECTED"){
            document.getElementById('qr-container').style.display = 'none';
            document.getElementById('form-container').style.display = 'block';
        } else {
            setTimeout(getQR, 5000); // Tenta atualizar QR a cada 5s
        }
    });
}

// Envio do formulário
document.getElementById('msgForm').addEventListener('submit', function(e){
    e.preventDefault();
    let formData = new FormData(this);
    fetch('/send_message', { method:'POST', body:formData })
    .then(res => res.json())
    .then(data => alert('Resposta: ' + JSON.stringify(data)));
});
</script>
</body>
</html>
  
